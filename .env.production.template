# SMTPy Production Environment Configuration
# Copy this file to .env.production and fill in your values
#
# SECURITY WARNING:
# - Never commit .env.production to git
# - Use strong, unique passwords
# - Rotate secrets regularly
# - Use a secrets manager for production (AWS Secrets Manager, HashiCorp Vault, etc.)

# =============================================================================
# DATABASE CONFIGURATION
# =============================================================================

# PostgreSQL database name
POSTGRES_DB=smtpy

# PostgreSQL username
POSTGRES_USER=postgres

# PostgreSQL password
# REQUIRED: Generate with: openssl rand -base64 32
POSTGRES_PASSWORD=xZWS04LrAQfOv574yt3i7CkGh0EnI6EFLZfClRAX44E=

# PostgreSQL port (default: 5432)
POSTGRES_PORT=5432

# =============================================================================
# REDIS CONFIGURATION
# =============================================================================

# Redis password
# REQUIRED: Generate with: openssl rand -base64 32
REDIS_PASSWORD=r6dcb5Q3xFdZnRbmJU0n8id+wV3x/CKjUH4imo5fRzw=

# Redis port (default: 6379)
REDIS_PORT=6379

# =============================================================================
# APPLICATION SECURITY
# =============================================================================

# Secret key for signing sessions and tokens
# REQUIRED: Generate with: python -c "import secrets; print(secrets.token_urlsafe(32))"
SECRET_KEY=hHwhqk2NrFjUcs6htyUTjWVTOTsA1-6-Xlq4JE4Z0qE

# Debug mode (MUST be false in production)
DEBUG=false

# Production environment flag
IS_PRODUCTION=true

# Logging level (DEBUG, INFO, WARNING, ERROR, CRITICAL)
LOG_LEVEL=INFO

# =============================================================================
# STRIPE BILLING CONFIGURATION
# =============================================================================

# Stripe API key (use live key, not test)
# Get from: https://dashboard.stripe.com/apikeys
STRIPE_API_KEY=sk_live_CHANGE_ME

# Stripe webhook secret
# Get from: https://dashboard.stripe.com/webhooks
STRIPE_WEBHOOK_SECRET=whsec_CHANGE_ME

# Stripe redirect URLs
STRIPE_SUCCESS_URL=https://smtpy.fr/billing/success
STRIPE_CANCEL_URL=https://smtpy.fr/billing/cancel
STRIPE_PORTAL_RETURN_URL=https://smtpy.fr/billing

# =============================================================================
# CORS AND NETWORKING
# =============================================================================

# Allowed CORS origins (comma-separated)
# Example: https://yourdomain.com,https://www.yourdomain.com
CORS_ORIGINS=https://smtpy.fr

# Port configuration
HTTP_PORT=80
HTTPS_PORT=443
API_PORT=8000
SMTP_PORT=1025

# =============================================================================
# SELF-HOSTED SMTP CONFIGURATION
# =============================================================================

# Self-hosted SMTP delivery system - no external dependencies by default!
# SMTPy includes a complete SMTP delivery system that sends emails directly
# to recipient mail servers without requiring Gmail, SendGrid, or other services.

# Your sending hostname (Fully Qualified Domain Name)
SMTP_HOSTNAME=mail.smtpy.fr

# Email delivery mode:
#   - direct: Self-hosted delivery (no external dependencies) [RECOMMENDED]
#   - relay: Use external SMTP service (Gmail, SendGrid, etc.)
#   - hybrid: Try direct first, fall back to relay on failure
#   - smart: AI-driven routing based on domain reputation (future)
SMTP_DELIVERY_MODE=direct

# Enable DKIM signing for better deliverability
SMTP_ENABLE_DKIM=true

# =============================================================================
# EXTERNAL SMTP RELAY (Optional - only needed for 'relay' or 'hybrid' modes)
# =============================================================================

# External relay server (optional, only if using relay/hybrid mode)
# Examples:
#   - Gmail: smtp.gmail.com:587 (with TLS)
#   - SendGrid: smtp.sendgrid.net:587
#   - Mailgun: smtp.mailgun.org:587
#   - AWS SES: email-smtp.us-east-1.amazonaws.com:587
# SMTP_HOST=smtp.gmail.com
# SMTP_PORT=587
# SMTP_USE_TLS=true
# SMTP_USE_SSL=false

# SMTP authentication (optional, only if using external relay)
# SMTP_USER=your-email@gmail.com
# SMTP_PASSWORD=your-app-password

# =============================================================================
# DNS REQUIREMENTS FOR SELF-HOSTED SMTP (CRITICAL)
# =============================================================================
#
# For self-hosted SMTP (direct/hybrid modes), you MUST configure:
#
# 1. Reverse DNS (PTR) Record - Contact your hosting provider:
#    45.80.25.57 â†’ mail.smtpy.fr
#    Verify: dig -x 45.80.25.57
#
# 2. SPF Record - Add to your domain's DNS:
#    example.com. IN TXT "v=spf1 include:smtpy.fr ~all"
#    Or: "v=spf1 ip4:45.80.25.57 ~all"
#
# 3. DKIM Record - Generated automatically by SMTPy, add to DNS:
#    default._domainkey.example.com. IN TXT "v=DKIM1; k=rsa; p=<public-key>"
#
# 4. DMARC Record - Add to your domain's DNS:
#    _dmarc.example.com. IN TXT "v=DMARC1; p=quarantine; rua=mailto:dmarc@example.com"
#
# 5. Firewall - Allow outbound SMTP:
#    sudo ufw allow out 25/tcp
#    sudo ufw allow 25/tcp
#
# For complete setup instructions, see:
# - back/smtp/relay/README.md
# - docs/DEPLOYMENT_GUIDE.md (Self-Hosted SMTP Configuration section)

# =============================================================================
# WORKER CONFIGURATION
# =============================================================================

# Number of API workers
# Recommended: (2 x CPU cores) + 1
# For 4 CPU cores: 4 workers
# For 8 CPU cores: 8 workers
API_WORKERS=4

# =============================================================================
# DOCKER REGISTRY (Optional)
# =============================================================================

# Docker registry for pulling images
# Leave as ghcr.io if using GitHub Container Registry
DOCKER_REGISTRY=ghcr.io

# GitHub Container Registry owner (your username or org)
GHCR_OWNER=larrymotalavigne

# Image tag to deploy
# Use specific version tags in production (not 'latest')
# Example: v1.0.0, v1.0.1, etc.
TAG=latest

# =============================================================================
# INSTRUCTIONS
# =============================================================================

# 1. Copy this file:
#    cp .env.production.template .env.production
#
# 2. Generate secure passwords:
#    openssl rand -base64 32
#
# 3. Generate secret key:
#    python -c "import secrets; print(secrets.token_urlsafe(32))"
#
# 4. Configure Stripe:
#    - Get API key from https://dashboard.stripe.com/apikeys
#    - Create webhook at https://dashboard.stripe.com/webhooks
#    - Copy webhook secret
#
# 5. Update CORS_ORIGINS with your domain
#
# 6. Save .env.production
#
# 7. Verify configuration:
#    grep "CHANGE_ME" .env.production
#    # Should return no results
#
# 8. Deploy:
#    docker compose -f docker-compose.prod.yml up -d

# =============================================================================
# SECURITY NOTES
# =============================================================================

# - Add .env.production to .gitignore (already done)
# - Never share this file or commit to version control
# - Use different passwords for each environment (dev, staging, prod)
# - Rotate passwords and keys regularly (every 90 days recommended)
# - Store backup of this file in secure location (password manager, encrypted storage)
# - Consider using external secrets management in production:
#   * AWS Secrets Manager
#   * HashiCorp Vault
#   * Azure Key Vault
#   * Google Cloud Secret Manager
