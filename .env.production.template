# SMTPy Production Environment Configuration
# Copy this file to .env.production and fill in your values
#
# SECURITY WARNING:
# - Never commit .env.production to git
# - Use strong, unique passwords
# - Rotate secrets regularly
# - Use a secrets manager for production (AWS Secrets Manager, HashiCorp Vault, etc.)

# =============================================================================
# DATABASE CONFIGURATION
# =============================================================================

# PostgreSQL database name
POSTGRES_DB=smtpy

# PostgreSQL username
POSTGRES_USER=postgres

# PostgreSQL password
# REQUIRED: Generate with: openssl rand -base64 32
POSTGRES_PASSWORD=xZWS04LrAQfOv574yt3i7CkGh0EnI6EFLZfClRAX44E=

# PostgreSQL port (default: 5432)
POSTGRES_PORT=5432

# =============================================================================
# REDIS CONFIGURATION
# =============================================================================

# Redis password
# REQUIRED: Generate with: openssl rand -base64 32
REDIS_PASSWORD=r6dcb5Q3xFdZnRbmJU0n8id+wV3x/CKjUH4imo5fRzw=

# Redis port (default: 6379)
REDIS_PORT=6379

# =============================================================================
# APPLICATION SECURITY
# =============================================================================

# Secret key for signing sessions and tokens
# REQUIRED: Generate with: python -c "import secrets; print(secrets.token_urlsafe(32))"
SECRET_KEY=hHwhqk2NrFjUcs6htyUTjWVTOTsA1-6-Xlq4JE4Z0qE

# Debug mode (MUST be false in production)
DEBUG=false

# Production environment flag
IS_PRODUCTION=true

# Logging level (DEBUG, INFO, WARNING, ERROR, CRITICAL)
LOG_LEVEL=INFO

# =============================================================================
# STRIPE BILLING CONFIGURATION
# =============================================================================

# Stripe API key (use live key, not test)
# Get from: https://dashboard.stripe.com/apikeys
STRIPE_API_KEY=sk_live_CHANGE_ME

# Stripe webhook secret
# Get from: https://dashboard.stripe.com/webhooks
STRIPE_WEBHOOK_SECRET=whsec_CHANGE_ME

# Stripe redirect URLs
STRIPE_SUCCESS_URL=https://smtpy.fr/billing/success
STRIPE_CANCEL_URL=https://smtpy.fr/billing/cancel
STRIPE_PORTAL_RETURN_URL=https://smtpy.fr/billing

# =============================================================================
# CORS AND NETWORKING
# =============================================================================

# Allowed CORS origins (comma-separated)
# Example: https://yourdomain.com,https://www.yourdomain.com
CORS_ORIGINS=https://smtpy.fr

# Port configuration
HTTP_PORT=80
HTTPS_PORT=443
API_PORT=8000

# =============================================================================
# DOCKER MAILSERVER CONFIGURATION (for docker-compose.prod.yml)
# =============================================================================

# Docker mailserver hostname (container name in docker-compose)
MAILSERVER_HOST=mailserver

# Mailserver SMTP submission port (for sending emails)
MAILSERVER_PORT=587

# Mailserver authentication (if required)
# MAILSERVER_USER=
# MAILSERVER_PASSWORD=

# Use STARTTLS for mailserver connection
MAILSERVER_USE_TLS=true

# SMTP Receiver Configuration (for receiving emails from mailserver)
SMTP_RECEIVER_HOST=0.0.0.0
SMTP_RECEIVER_PORT=2525

# Email sender configuration
EMAIL_ENABLED=true
EMAIL_FROM=noreply@smtpy.fr
EMAIL_FROM_NAME=SMTPy

# =============================================================================
# DOCKER MAILSERVER ADVANCED CONFIGURATION
# =============================================================================
# These advanced settings configure the Docker Mailserver service that's
# integrated into docker-compose.prod.yml.
#
# The mailserver provides full email server capabilities including:
# - SMTP (sending/receiving mail)
# - IMAP (accessing mail)
# - Anti-spam (Rspamd)
# - Anti-virus (ClamAV)
# - Security (Fail2ban, DKIM, DMARC, SPF)

# Mailserver Hostname (FQDN for your mail server)
MAILSERVER_HOSTNAME=mail.atomdev.fr

# Timezone
TZ=Europe/Paris

# Postmaster email address (receives admin notifications)
MAILSERVER_POSTMASTER=postmaster@atomdev.fr

# Log Level (trace, debug, info, warn, error)
MAILSERVER_LOG_LEVEL=info

# SSL/TLS Configuration
# Set to 'letsencrypt' after setting up SSL certificates
# Leave empty initially to start without SSL
MAILSERVER_SSL_TYPE=
MAILSERVER_TLS_LEVEL=modern

# Security Features
MAILSERVER_ENABLE_FAIL2BAN=1
MAILSERVER_SPOOF_PROTECTION=1

# Spam & Antivirus
MAILSERVER_ENABLE_RSPAMD=1
MAILSERVER_ENABLE_CLAMAV=1
MAILSERVER_ENABLE_AMAVIS=0
MAILSERVER_MOVE_SPAM_TO_JUNK=1
MAILSERVER_MARK_SPAM_AS_READ=0

# Mail Services
MAILSERVER_ENABLE_IMAP=1
MAILSERVER_ENABLE_POP3=0
MAILSERVER_ENABLE_MANAGESIEVE=1
MAILSERVER_ENABLE_QUOTAS=1

# Message Size Limits (in bytes)
# Leave empty to use defaults (10MB message, 500MB mailbox)
MAILSERVER_MESSAGE_SIZE_LIMIT=
MAILSERVER_MAILBOX_SIZE_LIMIT=

# External Relay Configuration (optional)
# Configure these if you want to relay outbound mail through another server
MAILSERVER_RELAY_HOST=
MAILSERVER_RELAY_USER=
MAILSERVER_RELAY_PASSWORD=

# Network Settings
# Set to 'connected-networks' or 'network' to allow relay from Docker networks
MAILSERVER_PERMIT_DOCKER=none
MAILSERVER_NETWORK_INTERFACE=eth0

# Update Checks
MAILSERVER_UPDATE_CHECK=1
MAILSERVER_UPDATE_INTERVAL=1d

# =============================================================================
# WORKER CONFIGURATION
# =============================================================================

# Number of API workers
# Recommended: (2 x CPU cores) + 1
# For 4 CPU cores: 4 workers
# For 8 CPU cores: 8 workers
API_WORKERS=4

# =============================================================================
# DOCKER REGISTRY (Optional)
# =============================================================================

# Docker registry for pulling images
# Leave as ghcr.io if using GitHub Container Registry
DOCKER_REGISTRY=ghcr.io

# GitHub Container Registry owner (your username or org)
GHCR_OWNER=larrymotalavigne

# Image tag to deploy
# Use specific version tags in production (not 'latest')
# Example: v1.0.0, v1.0.1, etc.
TAG=latest

# =============================================================================
# INSTRUCTIONS
# =============================================================================

# 1. Copy this file:
#    cp .env.production.template .env.production
#
# 2. Generate secure passwords:
#    openssl rand -base64 32
#
# 3. Generate secret key:
#    python -c "import secrets; print(secrets.token_urlsafe(32))"
#
# 4. Configure Stripe:
#    - Get API key from https://dashboard.stripe.com/apikeys
#    - Create webhook at https://dashboard.stripe.com/webhooks
#    - Copy webhook secret
#
# 5. Update CORS_ORIGINS with your domain
#
# 6. Save .env.production
#
# 7. Verify configuration:
#    grep "CHANGE_ME" .env.production
#    # Should return no results
#
# 8. Deploy:
#    docker compose -f docker-compose.prod.yml up -d

# =============================================================================
# SECURITY NOTES
# =============================================================================

# - Add .env.production to .gitignore (already done)
# - Never share this file or commit to version control
# - Use different passwords for each environment (dev, staging, prod)
# - Rotate passwords and keys regularly (every 90 days recommended)
# - Store backup of this file in secure location (password manager, encrypted storage)
# - Consider using external secrets management in production:
#   * AWS Secrets Manager
#   * HashiCorp Vault
#   * Azure Key Vault
#   * Google Cloud Secret Manager
