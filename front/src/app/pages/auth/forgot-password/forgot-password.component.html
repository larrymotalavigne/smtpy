<div class="auth-container">
  <div class="auth-content auth-content-small">
    <!-- Logo Section -->
    <div class="auth-header">
      <div class="auth-logo">
        <h1 class="logo-text">SMTPy</h1>
      </div>
      <h2 class="auth-title">Mot de passe oublié?</h2>
      <p class="auth-subtitle">Entrez votre email pour réinitialiser votre mot de passe</p>
    </div>

    <!-- Forgot Password Form Card -->
    <p-card class="auth-card">
      <ng-template pTemplate="content">
        <!-- Success State -->
        <div class="success-state" *ngIf="emailSent && successMessage">
          <div class="success-icon">
            <i class="pi pi-check-circle"></i>
          </div>
          <h3 class="success-title">Email envoyé!</h3>
          <p-message
            severity="success"
            [text]="successMessage"
            styleClass="w-full mb-4">
          </p-message>
          <p class="success-description">
            Si un compte existe avec cette adresse email, vous recevrez un lien de réinitialisation dans quelques minutes.
          </p>
          <p class="success-hint">
            Vérifiez également votre dossier spam si vous ne voyez pas l'email.
          </p>

          <div class="success-actions">
            <p-button
              label="Renvoyer l'email"
              icon="pi pi-refresh"
              [outlined]="true"
              (onClick)="resendEmail()"
              styleClass="w-full mb-3">
            </p-button>
            <p-button
              label="Retour à la connexion"
              icon="pi pi-arrow-left"
              (onClick)="backToLogin()"
              styleClass="w-full">
            </p-button>
          </div>
        </div>

        <!-- Form State -->
        <form [formGroup]="forgotPasswordForm" (ngSubmit)="onSubmit()" class="auth-form" *ngIf="!emailSent">
          <!-- Error Message -->
          <p-message
            *ngIf="errorMessage"
            severity="error"
            [text]="errorMessage"
            styleClass="w-full mb-4">
          </p-message>

          <!-- Info Message -->
          <p-message
            severity="info"
            text="Nous vous enverrons un lien de réinitialisation par email"
            styleClass="w-full mb-4">
          </p-message>

          <!-- Email Field -->
          <div class="form-field">
            <label for="email" class="form-label">
              Adresse email
              <span class="required">*</span>
            </label>
            <div class="input-wrapper">
              <i class="pi pi-envelope input-icon"></i>
              <input
                pInputText
                id="email"
                data-testid="forgot-password-email-field"
                type="email"
                formControlName="email"
                placeholder="votre@email.com"
                [class.invalid]="isFieldInvalid('email')"
                autocomplete="email"
                class="w-full" />
            </div>
            <small class="form-error" *ngIf="isFieldInvalid('email')">
              {{ getFieldError('email') }}
            </small>
          </div>

          <!-- Submit Button -->
          <p-button
            type="submit"
            data-testid="forgot-password-submit-button"
            label="Envoyer le lien"
            icon="pi pi-send"
            [loading]="loading"
            [disabled]="loading"
            styleClass="w-full submit-button">
          </p-button>

          <!-- Back to Login -->
          <div class="auth-footer">
            <a routerLink="/auth/login" class="back-link">
              <i class="pi pi-arrow-left"></i>
              Retour à la connexion
            </a>
          </div>
        </form>
      </ng-template>
    </p-card>

    <!-- Back to Home -->
    <div class="back-to-home">
      <a routerLink="/" class="home-link">
        <i class="pi pi-arrow-left"></i>
        Retour à l'accueil
      </a>
    </div>
  </div>
</div>

<!-- Toast for notifications -->
<p-toast></p-toast>
